{% load staticfiles %}
<html>
    <head>
        <meta charset="utf-8">
        <title>TOUR</title>
        <LINK rel="stylesheet" href="{% static "res/Font-Awesome-3.2.1/css/font-awesome.min.css" %}">
        <LINK rel="stylesheet" href="{% static "res/css/mystyle.css" %}">
        <LINK rel="stylesheet" href="{% static "res/css/main-yet.css" %}">

        <!--引入wangEditor.css-->
        <link rel="stylesheet" type="text/css" href="{% static "dist/css/wangEditor.min.css" %}">

        <script type="text/javascript" src="{% static "res/js/jquery-3.1.0.min.js" %}"></script>
        <script type="text/javascript" src="{% static "res/js/home.js" %}"> </script>
        <script src="{% static "res/js/jquery.searchMeme.js" %}"></script>

        <!--创建搜索框-->
        <script type="text/javascript">
            $(document).ready(function () {
            var searchbar = $('#search').searchMeme({ onSearch: function (searchText) {
                    setTimeout(function () {
                        searchbar.searchMeme({ searchComplete: true });
                        $('.panel').addClass('go-green').animate({ 'height': 200 }, 500);
                    }, 3000);
                }
                , buttonPlacement: 'right', button: 'green'
                });
            });
        </script>
    </head>

    <body class="home-body">
     <!--导航栏-->
    <div class="header">
        <div class="header-inner">
                    <a data-bn-ipg="head-logo" href="home.html"><img class="logo" src="logo.png" width="60" height="18" /></a>
                    <div class="nav">
                        <ul class="nav-ul">
                            <li class="nav-list "><a class="nav-span" href="trip.html" data-bn-ipg="head-nav-place" title="途尔行程">行程</a></li>
                            <li class="nav-list "><a class="nav-span" href="community.html" data-bn-ipg="head-nav-guide" title="途尔社区">社区</a></li>
                        </ul>
                    </div>
        <!--用户信息-->
        <div class="fun">
            <!--搜索框-->
            <div class="nav_search">
                <div class="isearch">
                    <input type="text" id="search" />
                </div>
            </div>
            <!--个人信息-->
            <div id="userStatus" class="status">
                <div class="user-info show">
                    <div class="userstatus">
                        <span class="avatar"><a href=""><img src="res/images/user-head.jpg" width="32" height="32"></a></span>
                        <span class="username"><a href="">Hypnos_zx</a></span>
                        <span style="vertical-align: -2px;"><img src="res/icons/down.png"></span>
                        <div class="q-layer-userstatus">
                            <ul>
                                <li>
                                    <a href="#user.html">我的首页</a>
                                </li>
                                <li>
                                    <span class="fr"><a class="link" href="#blogedit.html">写游记</a></span>
                                    <a href="#user.html">我的足迹</a>
                                </li>
                                <li>
                                    <a data-bn-ipg="index-head-userdrop-plan" href="#">我的行程</a>
                                </li>
                                <li class="setting">
                                    <span class="fr"><a class="link" data-bn-ipg="index-head-userdrop-logout" href="#userlogout">退出</a></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="usermsg">
                        <a class="message" href="javascript:;"><img src="res/icons/message.png"></a>
                        <div class="q-layer-userstatus">
                            <ul>
                                <li>
                                    <a href="#user.html">站内通知</a>
                                </li>
                                <li>
                                    <span class="fr"><a class="link" href="#blogedit.html">我的游记</a></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--内容-->
<div class="content" style="width:600px;text-align:center;height:600px;">
    <form action="/addjournal/" method="post" name="addform" id="addform">
  {% csrf_token %}
        <div id="div1" style="height: 20em ">
            <P><font color="black">请输入内容...</font></P>
    </div>

        <input type="button" name="btn1" id="btn1" value="提交游记">
  </form>
</div>

<!--底部链接栏-->
<div class="global_footer">
    <div class="footer_inner">
                <div class="inner_link clear">
                <dl>
                    <p>class="logo_footer index_icons"></p>
                </dl>
                <dl>
                <dt>联系我们</dt>
                <dd>
                <a class="global_gaNode" data-galabel="home_footer_nav_link" href="#a" rel="nofollow">意见反馈</a>
                <a class="global_gaNode" data-galabel="home_footer_nav_link" href="#b" rel="nofollow">广告代理</a>
                <a class="global_gaNode" data-galabel="home_footer_nav_link" href="#c" rel="nofollow">社区</a>
                </dd>
                </dl>
                <dl>
                <dt>关于我们</dt>
                <dd>
                <a class="global_gaNode" data-galabel="home_footer_nav_link" href="#aa" rel="nofollow">会员条款</a>
                <a class="global_gaNode" data-galabel="home_footer_nav_link" href="#bb" rel="nofollow">加入我们</a>
                <a class="global_gaNode" data-galabel="home_footer_nav_link" href="#cc" rel="nofollow">关于 TOUR</a>
                </dd>
                </dl>
                <dl class="footer_follow">
                <dt>关注我们</dt>
                <dd>
                <a class="global_gaNode" data-galabel="home_footer_nav_link" href="#weibo" target="_blank" rel="nofollow">新浪微博</a>
                <a class="global_gaNode" data-galabel="home_footer_nav_link" href="#contect" rel="nofollow">联系我们</a>
                </dd>
                </dl>
                <dl class="footer_wechat">
                <dt>官方微信</dt>
                <dd class="wechat_img"></dd>
                </dl>
                <dl class="footer_appDownload">
                <dt>APP 下载</dt>
                <dd class="app_img"></dd>
                </dl>
                </div>
            </div>
    </div>

    <!--引入jquery和wangEditor.js-->   <!--注意：javascript必须放在body最后，否则可能会出现问题-->
    <script type="text/javascript" src="{% static "dist/js/lib/jquery-1.10.2.min.js" %}"></script>
    <script type="text/javascript" src="{% static "dist/js/wangEditor.min.js" %}"></script>

    <script type="text/javascript">
            $(function () {
                var editor = new wangEditor('div1');
                    // 上传图片（举例）
                editor.config.uploadImgUrl = '/upload/';

                // 配置自定义参数（举例）
                editor.config.uploadParams = {
                    token: 'abcdefg',
                    user: 'wangfupeng1988'
                };

                // 设置 headers（举例）
                editor.config.uploadHeaders = {
                    'Accept' : 'text/x-json'
                };

                // 隐藏掉插入网络图片功能。该配置，只有在你正确配置了图片上传功能之后才可用。
                editor.config.hideLinkImg = true;
                editor.create();

                $('#btn1').click(function () {

                    // 获取编辑器区域完整html代码
                    var jhtml = editor.$txt.html();//我们要存这个

                    // 获取编辑器纯文本内容
                    var text = editor.$txt.text();
                    // 获取格式化后的纯文本
                    var formatText = editor.$txt.formatText();

                    console.log("完整html代码" + jhtml + "\n" + "纯文本内容" + text + "\n" + "格式化后纯文本" + formatText);

                    //尝试解决Forbidden的问题：

                    function getCookie(name) {
                        var cookieValue = null;
                        if (document.cookie && document.cookie != '') {
                            var cookies = document.cookie.split(';');
                            for (var i = 0; i < cookies.length; i++) {
                                var cookie = jQuery.trim(cookies[i]);
                                // Does this cookie string begin with the name we want?
                                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }

                    function csrfSafeMethod(method) {
                        // these HTTP methods do not require CSRF protection
                        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                    }

                    $.ajaxSetup({
                        beforeSend: function (xhr, settings) {
                            var csrftoken = getCookie('csrftoken');
                            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                                xhr.setRequestHeader("X-CSRFToken", csrftoken);
                            }
                        }
                    });

                    //用ajax把从前台获取到的wangeditor中的内容发送到后台去
                    $.ajax({
                        url: '/addjournal/',
                        type: 'POST',
                        data: jhtml,
                        dataType: 'html',
                        success: function (result) {
                            alert('success');
                            //console.log('Success!');
                        },
                        error: function (xhr, status, error) {
                            //alert('Error:' + error.message);
                        }
                    });

                    $('#addform').submit();//提交表单
                });
            });
    </script>


    </body>
</html>
